<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e3a5f">
    <link rel="manifest" href="manifest.json">
    <title>日本酒コレクター</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700;900&family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Zen Kaku Gothic New', 'Noto Sans JP', sans-serif;
            background: #0f1419;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(212, 165, 116, 0.03) 10px, rgba(212, 165, 116, 0.03) 20px),
                repeating-linear-gradient(-45deg, transparent, transparent 10px, rgba(30, 58, 95, 0.03) 10px, rgba(30, 58, 95, 0.03) 20px),
                linear-gradient(135deg, #1a1f2e 0%, #0f1419 50%, #1a1f2e 100%);
            background-attachment: fixed;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(212, 165, 116, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 115, 85, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        body > * {
            position: relative;
            z-index: 1;
        }
        
        h1 {
            font-family: 'Noto Serif JP', serif;
            color: #f4e4c1;
            margin-bottom: 25px;
            text-align: center;
            font-size: 32px;
            font-weight: 900;
            text-shadow: 
                0 0 20px rgba(212, 165, 116, 0.6),
                0 0 40px rgba(212, 165, 116, 0.3),
                2px 2px 4px rgba(0,0,0,0.8);
            letter-spacing: 4px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        h1::before {
            content: '';
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #d4a574 0%, #b8935f 100%);
            mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpath d='M12 2v20M2 12h20M7 7l10 10M7 17l10-10'/%3E%3C/svg%3E");
            mask-size: contain;
            animation: sparkle 3s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0.6; transform: scale(1) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.1) rotate(180deg); }
        }
        
        .stats {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a7b 100%);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-around;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.6),
                inset 0 1px 0 rgba(255,255,255,0.1),
                0 0 60px rgba(212, 165, 116, 0.2);
            border: 2px solid rgba(212, 165, 116, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .stats::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(212, 165, 116, 0.05) 10px,
                rgba(212, 165, 116, 0.05) 20px
            );
            animation: slidePattern 20s linear infinite;
        }
        
        @keyframes slidePattern {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        .stat-item {
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #f4e4c1 0%, #d4a574 50%, #f4e4c1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(212, 165, 116, 0.8);
            filter: drop-shadow(0 2px 8px rgba(212, 165, 116, 0.6));
        }
        
        .stat-label {
            font-size: 13px;
            color: #d4c5a9;
            margin-top: 8px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .form-container, .list-container {
            background: linear-gradient(135deg, rgba(26, 31, 46, 0.95) 0%, rgba(15, 20, 25, 0.95) 100%);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.8),
                inset 0 1px 0 rgba(212, 165, 116, 0.1);
            border: 2px solid rgba(212, 165, 116, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #d4a574;
            font-size: 14px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid rgba(212, 165, 116, 0.3);
            border-radius: 10px;
            font-size: 14px;
            background: rgba(26, 31, 46, 0.6);
            color: #f4e4c1;
            transition: all 0.3s;
            font-family: 'Zen Kaku Gothic New', sans-serif;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #d4a574;
            background: rgba(26, 31, 46, 0.9);
            box-shadow: 
                0 0 0 4px rgba(212, 165, 116, 0.2),
                0 0 30px rgba(212, 165, 116, 0.3);
        }
        
        textarea {
            resize: vertical;
            min-height: 90px;
        }
        
        .search-container {
            margin-bottom: 20px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 16px 50px 16px 50px;
            border: 2px solid rgba(212, 165, 116, 0.4);
            border-radius: 12px;
            font-size: 16px;
            background: rgba(26, 31, 46, 0.8);
            color: #f4e4c1;
            transition: all 0.3s;
        }
        
        .search-input::placeholder {
            color: rgba(212, 165, 116, 0.5);
        }
        
        .search-input:focus {
            outline: none;
            border-color: #d4a574;
            background: rgba(26, 31, 46, 0.95);
            box-shadow: 
                0 0 0 4px rgba(212, 165, 116, 0.2),
                0 0 40px rgba(212, 165, 116, 0.4);
        }
        
        .search-container::before {
            content: '';
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: #d4a574;
            mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E");
            mask-size: contain;
        }
        
        .search-clear {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #8b7355 0%, #6d5a45 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 20px;
            display: none;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(139, 115, 85, 0.4);
        }
        
        .search-clear:hover {
            transform: translateY(-50%) scale(1.1) rotate(90deg);
            box-shadow: 0 6px 20px rgba(139, 115, 85, 0.6);
        }
        
        .search-result-count {
            font-size: 14px;
            color: #d4a574;
            margin-bottom: 15px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .photo-upload-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .photo-upload-box {
            flex: 1;
            border: 3px dashed rgba(212, 165, 116, 0.4);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: 
                linear-gradient(135deg, rgba(26, 31, 46, 0.6) 0%, rgba(15, 20, 25, 0.6) 100%),
                repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(212, 165, 116, 0.02) 5px, rgba(212, 165, 116, 0.02) 10px);
            position: relative;
            overflow: hidden;
        }
        
        .photo-upload-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(212, 165, 116, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .photo-upload-box:hover::before {
            opacity: 1;
        }
        
        .photo-upload-box:hover {
            border-color: #d4a574;
            background: rgba(26, 31, 46, 0.9);
            box-shadow: 
                0 8px 24px rgba(212, 165, 116, 0.3),
                inset 0 0 60px rgba(212, 165, 116, 0.1);
            transform: translateY(-2px);
        }
        
        .photo-upload-box img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
            border: 2px solid rgba(212, 165, 116, 0.3);
        }
        
        .photo-upload-label {
            font-size: 14px;
            color: #d4a574;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            position: relative;
            z-index: 1;
        }
        
        .photo-upload-text {
            font-size: 13px;
            color: rgba(212, 165, 116, 0.6);
            margin-top: 8px;
            position: relative;
            z-index: 1;
        }
        
        .photo-preview {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .photo-preview img {
            width: calc(50% - 7.5px);
            border-radius: 10px;
            border: 3px solid rgba(212, 165, 116, 0.4);
            box-shadow: 
                0 4px 20px rgba(0,0,0,0.6),
                0 0 40px rgba(212, 165, 116, 0.2);
        }
        
        input[type="file"] {
            display: none;
        }
        
        .stars {
            display: flex;
            gap: 8px;
            cursor: pointer;
        }
        
        .star {
            font-size: 28px;
            color: rgba(212, 165, 116, 0.3);
            transition: all 0.3s;
            filter: drop-shadow(0 0 5px rgba(212, 165, 116, 0.3));
        }
        
        .star:hover {
            transform: scale(1.3) rotate(15deg);
        }
        
        .star.active {
            background: linear-gradient(135deg, #d4a574 0%, #f4e4c1 50%, #d4a574 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 10px rgba(212, 165, 116, 0.8));
            animation: starGlow 2s ease-in-out infinite;
        }
        
        @keyframes starGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(212, 165, 116, 0.8)); }
            50% { filter: drop-shadow(0 0 20px rgba(212, 165, 116, 1)); }
        }
        
        button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #d4a574 0%, #b8935f 50%, #d4a574 100%);
            background-size: 200% 100%;
            color: #0f1419;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            transition: all 0.4s;
            box-shadow: 
                0 6px 20px rgba(212, 165, 116, 0.5),
                inset 0 1px 0 rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover {
            background-position: 100% 0;
            transform: translateY(-3px);
            box-shadow: 
                0 10px 30px rgba(212, 165, 116, 0.7),
                inset 0 1px 0 rgba(255,255,255,0.5);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        .cancel-btn {
            background: linear-gradient(135deg, #6d5a45 0%, #5a4838 50%, #6d5a45 100%);
            background-size: 200% 100%;
            color: #f4e4c1;
            margin-top: 10px;
        }
        
        .sake-item {
            background: linear-gradient(135deg, rgba(26, 31, 46, 0.8) 0%, rgba(15, 20, 25, 0.8) 100%);
            padding: 25px;
            border-radius: 14px;
            margin-bottom: 20px;
            border-left: 6px solid #d4a574;
            box-shadow: 
                0 6px 24px rgba(0,0,0,0.6),
                inset 0 1px 0 rgba(212, 165, 116, 0.1);
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
        }
        
        .sake-item::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(212, 165, 116, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(50%, -50%);
        }
        
        .sake-item:hover {
            transform: translateX(8px);
            box-shadow: 
                0 10px 40px rgba(0,0,0,0.8),
                0 0 60px rgba(212, 165, 116, 0.3);
            border-left-color: #f4e4c1;
        }
        
        .sake-name {
            font-family: 'Noto Serif JP', serif;
            font-size: 22px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #f4e4c1 0%, #d4a574 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
        }
        
        .sake-info {
            font-size: 14px;
            color: #d4c5a9;
            margin-bottom: 8px;
            line-height: 1.8;
            position: relative;
            z-index: 1;
        }
        
        .sake-memo {
            font-size: 14px;
            color: #c4b89d;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(212, 165, 116, 0.2);
            line-height: 1.8;
            position: relative;
            z-index: 1;
        }
        
        .badge {
            display: inline-block;
            padding: 6px 14px;
            background: linear-gradient(135deg, #d4a574 0%, #b8935f 100%);
            color: #0f1419;
            border-radius: 8px;
            font-size: 12px;
            margin-right: 8px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: 0 2px 8px rgba(212, 165, 116, 0.4);
        }
        
        .action-buttons {
            float: right;
            display: flex;
            gap: 8px;
            position: relative;
            z-index: 1;
        }
        
        .edit-btn, .delete-btn {
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s;
        }
        
        .edit-btn {
            background: linear-gradient(135deg, #5a8a6f 0%, #4a7a5f 100%);
            box-shadow: 0 4px 12px rgba(90, 138, 111, 0.4);
        }
        
        .edit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(90, 138, 111, 0.6);
        }
        
        .delete-btn {
            background: linear-gradient(135deg, #a85c5c 0%, #8a4a4a 100%);
            box-shadow: 0 4px 12px rgba(168, 92, 92, 0.4);
        }
        
        .delete-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(168, 92, 92, 0.6);
        }
        
        h2 {
            font-family: 'Noto Serif JP', serif;
            margin-bottom: 25px;
            background: linear-gradient(135deg, #f4e4c1 0%, #d4a574 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 24px;
            font-weight: 900;
            letter-spacing: 2px;
        }
        
        .section-title {
            font-family: 'Noto Serif JP', serif;
            font-size: 16px;
            font-weight: 700;
            margin-top: 30px;
            margin-bottom: 15px;
            color: #d4a574;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding-bottom: 10px;
            border-bottom: 3px solid rgba(212, 165, 116, 0.3);
            position: relative;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #d4a574 0%, transparent 100%);
        }
        
        .edit-mode {
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.15) 0%, rgba(184, 147, 95, 0.15) 100%);
            border: 3px solid #d4a574;
            box-shadow: 
                0 0 60px rgba(212, 165, 116, 0.4),
                inset 0 0 60px rgba(212, 165, 116, 0.1);
        }
        
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            border-bottom: 3px solid rgba(212, 165, 116, 0.3);
        }
        
        .tab {
            padding: 14px 28px;
            background: none;
            border: none;
            color: rgba(212, 165, 116, 0.6);
            cursor: pointer;
            font-size: 15px;
            font-weight: 700;
            border-bottom: 4px solid transparent;
            margin-bottom: -3px;
            transition: all 0.3s;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .tab:hover {
            color: #d4a574;
        }
        
        .tab.active {
            color: #f4e4c1;
            border-bottom-color: #d4a574;
            text-shadow: 0 0 20px rgba(212, 165, 116, 0.6);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .prefecture-group {
            margin-bottom: 25px;
        }
        
        .prefecture-header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a7b 100%);
            color: white;
            padding: 18px 22px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            transition: all 0.4s;
            box-shadow: 
                0 6px 20px rgba(30, 58, 95, 0.5),
                inset 0 1px 0 rgba(255,255,255,0.1);
            border: 2px solid rgba(212, 165, 116, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .prefecture-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 165, 116, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .prefecture-header:hover::before {
            left: 100%;
        }
        
        .prefecture-header:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 10px 40px rgba(30, 58, 95, 0.7),
                0 0 60px rgba(212, 165, 116, 0.3);
        }
        
        .prefecture-name {
            font-family: 'Noto Serif JP', serif;
            font-weight: 900;
            font-size: 18px;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
        }
        
        .prefecture-count {
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.3), rgba(212, 165, 116, 0.5));
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 165, 116, 0.4);
            box-shadow: 0 2px 10px rgba(212, 165, 116, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .prefecture-items {
            margin-top: 15px;
            display: none;
        }
        
        .prefecture-items.open {
            display: block;
            animation: slideDown 0.4s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <h1>日本酒コレクター</h1>
    
    <div class="stats">
        <div class="stat-item">
            <div class="stat-number" id="totalCount">0</div>
            <div class="stat-label">総数</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="prefCount">0</div>
            <div class="stat-label">都道府県</div>
        </div>
    </div>
    
    <div class="form-container" id="formContainer">
        <h2 id="formTitle">新規登録</h2>
        
        <div class="section-title">写真</div>
        
        <div class="photo-upload-container">
            <div class="photo-upload-box" onclick="document.getElementById('frontPhoto').click()">
                <img id="frontPreview" style="display: none;">
                <div id="frontPlaceholder">
                    <div class="photo-upload-label">表ラベル</div>
                    <div class="photo-upload-text">タップして追加</div>
                </div>
                <input type="file" id="frontPhoto" accept="image/*" onchange="handlePhotoUpload('front')">
            </div>
            
            <div class="photo-upload-box" onclick="document.getElementById('backPhoto').click()">
                <img id="backPreview" style="display: none;">
                <div id="backPlaceholder">
                    <div class="photo-upload-label">裏ラベル</div>
                    <div class="photo-upload-text">タップして追加</div>
                </div>
                <input type="file" id="backPhoto" accept="image/*" onchange="handlePhotoUpload('back')">
            </div>
        </div>
        
        <div class="section-title">基本情報</div>
        
        <div class="form-group">
            <label>銘柄名 *</label>
            <input type="text" id="name" required>
        </div>
        
        <div class="form-group">
            <label>酒蔵名 *</label>
            <input type="text" id="brewery" required>
        </div>
        
        <div class="form-group">
            <label>都道府県 *</label>
            <select id="prefecture" required>
                <option value="">選択してください</option>
                <option value="北海道">北海道</option>
                <option value="青森県">青森県</option>
                <option value="岩手県">岩手県</option>
                <option value="宮城県">宮城県</option>
                <option value="秋田県">秋田県</option>
                <option value="山形県">山形県</option>
                <option value="福島県">福島県</option>
                <option value="茨城県">茨城県</option>
                <option value="栃木県">栃木県</option>
                <option value="群馬県">群馬県</option>
                <option value="埼玉県">埼玉県</option>
                <option value="千葉県">千葉県</option>
                <option value="東京都">東京都</option>
                <option value="神奈川県">神奈川県</option>
                <option value="新潟県">新潟県</option>
                <option value="富山県">富山県</option>
                <option value="石川県">石川県</option>
                <option value="福井県">福井県</option>
                <option value="山梨県">山梨県</option>
                <option value="長野県">長野県</option>
                <option value="岐阜県">岐阜県</option>
                <option value="静岡県">静岡県</option>
                <option value="愛知県">愛知県</option>
                <option value="三重県">三重県</option>
                <option value="滋賀県">滋賀県</option>
                <option value="京都府">京都府</option>
                <option value="大阪府">大阪府</option>
                <option value="兵庫県">兵庫県</option>
                <option value="奈良県">奈良県</option>
                <option value="和歌山県">和歌山県</option>
                <option value="鳥取県">鳥取県</option>
                <option value="島根県">島根県</option>
                <option value="岡山県">岡山県</option>
                <option value="広島県">広島県</option>
                <option value="山口県">山口県</option>
                <option value="徳島県">徳島県</option>
                <option value="香川県">香川県</option>
                <option value="愛媛県">愛媛県</option>
                <option value="高知県">高知県</option>
                <option value="福岡県">福岡県</option>
                <option value="佐賀県">佐賀県</option>
                <option value="長崎県">長崎県</option>
                <option value="熊本県">熊本県</option>
                <option value="大分県">大分県</option>
                <option value="宮崎県">宮崎県</option>
                <option value="鹿児島県">鹿児島県</option>
                <option value="沖縄県">沖縄県</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>飲んだ日</label>
            <input type="date" id="date">
        </div>
        
        <div class="section-title">日本酒情報</div>
        
        <div class="form-group">
            <label>特定名称</label>
            <select id="classification">
                <option value="">選択してください</option>
                <option value="普通酒">普通酒</option>
                <option value="本醸造酒">本醸造酒</option>
                <option value="特別本醸造酒">特別本醸造酒</option>
                <option value="純米酒">純米酒</option>
                <option value="特別純米酒">特別純米酒</option>
                <option value="吟醸酒">吟醸酒</option>
                <option value="純米吟醸酒">純米吟醸酒</option>
                <option value="大吟醸酒">大吟醸酒</option>
                <option value="純米大吟醸酒">純米大吟醸酒</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>日本酒度</label>
            <input type="text" id="nihonshuDo" placeholder="例: +5">
        </div>
        
        <div class="form-group">
            <label>精米歩合</label>
            <input type="text" id="seimaibuai" placeholder="例: 50%">
        </div>
        
        <div class="form-group">
            <label>アルコール度数</label>
            <input type="text" id="alcohol" placeholder="例: 15度">
        </div>
        
        <div class="form-group">
            <label>火入れ</label>
            <select id="hiire">
                <option value="">選択してください</option>
                <option value="生酒">生酒</option>
                <option value="火入れ">火入れ</option>
                <option value="不明">不明</option>
            </select>
        </div>
        
        <div class="section-title">個人記録</div>
        
        <div class="form-group">
            <label>味の評価</label>
            <div class="stars" id="tasteRating">
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
            </div>
        </div>
        
        <div class="form-group">
            <label>おすすめ度</label>
            <div class="stars" id="recommendRating">
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
            </div>
        </div>
        
        <div class="form-group">
            <label>味わいメモ</label>
            <textarea id="memo" placeholder="香り、味わいの印象を自由に記入..."></textarea>
        </div>
        
        <div class="form-group">
            <label>飲んだ場所</label>
            <input type="text" id="place" placeholder="例: 自宅、居酒屋◯◯">
        </div>
        
        <button onclick="saveSake()" id="saveBtn">登録する</button>
        <button onclick="cancelEdit()" id="cancelBtn" class="cancel-btn" style="display: none;">キャンセル</button>
    </div>
    
    <div class="list-container">
        <h2>コレクション一覧</h2>
        
        <div class="search-container">
            <input type="text" id="searchInput" class="search-input" placeholder="銘柄名・酒蔵名で検索..." oninput="handleSearch()">
            <button class="search-clear" id="searchClear" onclick="clearSearch()">×</button>
        </div>
        
        <div class="search-result-count" id="searchResultCount"></div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('all')">すべて</button>
            <button class="tab" onclick="switchTab('prefecture')">都道府県別</button>
        </div>
        
        <div id="allTab" class="tab-content active">
            <div id="sakeList"></div>
        </div>
        
        <div id="prefectureTab" class="tab-content">
            <div id="prefectureList"></div>
        </div>
    </div>

    <script>
        // Service Worker登録（PWA化）
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js');
        }

        let collection = [];
        let filteredCollection = [];
        let tasteRatingValue = 0;
        let recommendRatingValue = 0;
        let editingId = null;
        let frontPhotoData = null;
        let backPhotoData = null;
        let currentTab = 'all';
        let searchQuery = '';
        
        // ページ読み込み時にデータを復元
        window.onload = function() {
            const saved = localStorage.getItem('sakeCollection');
            if (saved) {
                collection = JSON.parse(saved);
                filteredCollection = collection;
                displayCollection();
                displayPrefectureList();
            }
            updateStats();
        };
        
        // 検索処理
        function handleSearch() {
            searchQuery = document.getElementById('searchInput').value.toLowerCase();
            const clearBtn = document.getElementById('searchClear');
            
            if (searchQuery) {
                clearBtn.style.display = 'block';
                filteredCollection = collection.filter(sake => {
                    return sake.name.toLowerCase().includes(searchQuery) || 
                           sake.brewery.toLowerCase().includes(searchQuery);
                });
            } else {
                clearBtn.style.display = 'none';
                filteredCollection = collection;
            }
            
            updateSearchResultCount();
            
            if (currentTab === 'all') {
                displayCollection();
            } else {
                displayPrefectureList();
            }
        }
        
        // 検索クリア
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            handleSearch();
        }
        
        // 検索結果件数の表示
        function updateSearchResultCount() {
            const countDiv = document.getElementById('searchResultCount');
            if (searchQuery) {
                countDiv.textContent = `検索結果: ${filteredCollection.length}件`;
            } else {
                countDiv.textContent = '';
            }
        }
        
        // タブ切り替え
        function switchTab(tab) {
            currentTab = tab;
            
            // タブのアクティブ状態を切り替え
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'all') {
                document.querySelector('.tab:first-child').classList.add('active');
                document.getElementById('allTab').classList.add('active');
                displayCollection();
            } else {
                document.querySelector('.tab:last-child').classList.add('active');
                document.getElementById('prefectureTab').classList.add('active');
                displayPrefectureList();
            }
        }
        
        // 都道府県グループの開閉
        function togglePrefecture(prefecture) {
            const items = document.getElementById('pref-' + prefecture.replace(/[都道府県]/g, ''));
            items.classList.toggle('open');
        }
        
        // 写真アップロード処理
        function handlePhotoUpload(type) {
            const input = document.getElementById(type + 'Photo');
            const preview = document.getElementById(type + 'Preview');
            const placeholder = document.getElementById(type + 'Placeholder');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    placeholder.style.display = 'none';
                    
                    if (type === 'front') {
                        frontPhotoData = e.target.result;
                    } else {
                        backPhotoData = e.target.result;
                    }
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // 星評価の設定
        document.querySelectorAll('.stars').forEach(container => {
            const stars = container.querySelectorAll('.star');
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const value = parseInt(this.dataset.value);
                    if (container.id === 'tasteRating') {
                        tasteRatingValue = value;
                    } else {
                        recommendRatingValue = value;
                    }
                    updateStars(container, value);
                });
            });
        });
        
        function updateStars(container, value) {
            const stars = container.querySelectorAll('.star');
            stars.forEach((star, index) => {
                if (index < value) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }
        
        function saveSake() {
            const name = document.getElementById('name').value;
            const brewery = document.getElementById('brewery').value;
            const prefecture = document.getElementById('prefecture').value;
            
            if (!name || !brewery || !prefecture) {
                alert('必須項目を入力してください');
                return;
            }
            
            const sake = {
                id: editingId || Date.now(),
                name: name,
                brewery: brewery,
                prefecture: prefecture,
                date: document.getElementById('date').value,
                classification: document.getElementById('classification').value,
                nihonshuDo: document.getElementById('nihonshuDo').value,
                seimaibuai: document.getElementById('seimaibuai').value,
                alcohol: document.getElementById('alcohol').value,
                hiire: document.getElementById('hiire').value,
                tasteRating: tasteRatingValue,
                recommendRating: recommendRatingValue,
                memo: document.getElementById('memo').value,
                place: document.getElementById('place').value,
                frontPhoto: frontPhotoData,
                backPhoto: backPhotoData
            };
            
            if (editingId) {
                collection = collection.map(item => item.id === editingId ? sake : item);
                alert('更新しました！');
            } else {
                collection.push(sake);
                alert('登録しました！');
            }
            
            localStorage.setItem('sakeCollection', JSON.stringify(collection));
            resetForm();
            handleSearch(); // 検索を再実行
            updateStats();
        }
        
        function editSake(id) {
            const sake = collection.find(item => item.id === id);
            if (!sake) return;
            
            document.getElementById('name').value = sake.name;
            document.getElementById('brewery').value = sake.brewery;
            document.getElementById('prefecture').value = sake.prefecture;
            document.getElementById('date').value = sake.date || '';
            document.getElementById('classification').value = sake.classification || '';
            document.getElementById('nihonshuDo').value = sake.nihonshuDo || '';
            document.getElementById('seimaibuai').value = sake.seimaibuai || '';
            document.getElementById('alcohol').value = sake.alcohol || '';
            document.getElementById('hiire').value = sake.hiire || '';
            document.getElementById('memo').value = sake.memo || '';
            document.getElementById('place').value = sake.place || '';
            
            frontPhotoData = sake.frontPhoto || null;
            backPhotoData = sake.backPhoto || null;
            
            if (frontPhotoData) {
                document.getElementById('frontPreview').src = frontPhotoData;
                document.getElementById('frontPreview').style.display = 'block';
                document.getElementById('frontPlaceholder').style.display = 'none';
            }
            
            if (backPhotoData) {
                document.getElementById('backPreview').src = backPhotoData;
                document.getElementById('backPreview').style.display = 'block';
                document.getElementById('backPlaceholder').style.display = 'none';
            }
            
            tasteRatingValue = sake.tasteRating || 0;
            recommendRatingValue = sake.recommendRating || 0;
            updateStars(document.getElementById('tasteRating'), tasteRatingValue);
            updateStars(document.getElementById('recommendRating'), recommendRatingValue);
            
            editingId = id;
            document.getElementById('formTitle').textContent = '編集';
            document.getElementById('saveBtn').textContent = '更新する';
            document.getElementById('cancelBtn').style.display = 'block';
            document.getElementById('formContainer').classList.add('edit-mode');
            
            document.getElementById('formContainer').scrollIntoView({ behavior: 'smooth' });
        }
        
        function cancelEdit() {
            resetForm();
        }
        
        function resetForm() {
            document.getElementById('name').value = '';
            document.getElementById('brewery').value = '';
            document.getElementById('prefecture').value = '';
            document.getElementById('date').value = '';
            document.getElementById('classification').value = '';
            document.getElementById('nihonshuDo').value = '';
            document.getElementById('seimaibuai').value = '';
            document.getElementById('alcohol').value = '';
            document.getElementById('hiire').value = '';
            document.getElementById('memo').value = '';
            document.getElementById('place').value = '';
            tasteRatingValue = 0;
            recommendRatingValue = 0;
            document.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
            
            frontPhotoData = null;
            backPhotoData = null;
            document.getElementById('frontPreview').style.display = 'none';
            document.getElementById('frontPlaceholder').style.display = 'block';
            document.getElementById('backPreview').style.display = 'none';
            document.getElementById('backPlaceholder').style.display = 'block';
            document.getElementById('frontPhoto').value = '';
            document.getElementById('backPhoto').value = '';
            
            editingId = null;
            document.getElementById('formTitle').textContent = '新規登録';
            document.getElementById('saveBtn').textContent = '登録する';
            document.getElementById('cancelBtn').style.display = 'none';
            document.getElementById('formContainer').classList.remove('edit-mode');
        }
        
        function deleteSake(id) {
            if (confirm('削除しますか？')) {
                collection = collection.filter(sake => sake.id !== id);
                localStorage.setItem('sakeCollection', JSON.stringify(collection));
                handleSearch(); // 検索を再実行
                updateStats();
            }
        }
        
        function renderSakeItem(sake) {
            let photoHtml = '';
            if (sake.frontPhoto || sake.backPhoto) {
                photoHtml = '<div class="photo-preview">';
                if (sake.frontPhoto) {
                    photoHtml += `<img src="${sake.frontPhoto}" alt="表ラベル">`;
                }
                if (sake.backPhoto) {
                    photoHtml += `<img src="${sake.backPhoto}" alt="裏ラベル">`;
                }
                photoHtml += '</div>';
            }
            
            return `
                <div class="sake-item">
                    <div class="action-buttons">
                        <button class="edit-btn" onclick="editSake(${sake.id})">編集</button>
                        <button class="delete-btn" onclick="deleteSake(${sake.id})">削除</button>
                    </div>
                    ${photoHtml}
                    <div class="sake-name">${sake.name}</div>
                    <div class="sake-info">
                        ${sake.brewery} (${sake.prefecture})
                        ${sake.classification ? '<span class="badge">' + sake.classification + '</span>' : ''}
                    </div>
                    ${sake.date ? '<div class="sake-info">📅 ' + sake.date + '</div>' : ''}
                    ${sake.nihonshuDo ? '<div class="sake-info">日本酒度: ' + sake.nihonshuDo + '</div>' : ''}
                    ${sake.seimaibuai ? '<div class="sake-info">精米歩合: ' + sake.seimaibuai + '</div>' : ''}
                    ${sake.alcohol ? '<div class="sake-info">アルコール度数: ' + sake.alcohol + '</div>' : ''}
                    ${sake.hiire ? '<div class="sake-info">火入れ: ' + sake.hiire + '</div>' : ''}
                    ${sake.place ? '<div class="sake-info">📍 ' + sake.place + '</div>' : ''}
                    <div class="sake-info">
                        味の評価: ${'★'.repeat(sake.tasteRating)}${'☆'.repeat(5-sake.tasteRating)}
                        おすすめ度: ${'★'.repeat(sake.recommendRating)}${'☆'.repeat(5-sake.recommendRating)}
                    </div>
                    ${sake.memo ? '<div class="sake-memo">' + sake.memo + '</div>' : ''}
                </div>
            `;
        }
        
        function displayCollection() {
            const listDiv = document.getElementById('sakeList');
            
            if (filteredCollection.length === 0) {
                if (searchQuery) {
                    listDiv.innerHTML = '<p style="text-align:center;color:#999;">検索結果が見つかりませんでした</p>';
                } else {
                    listDiv.innerHTML = '<p style="text-align:center;color:#999;">まだ登録されていません</p>';
                }
                return;
            }
            
            listDiv.innerHTML = filteredCollection.map(renderSakeItem).join('');
        }
        
        function displayPrefectureList() {
            const listDiv = document.getElementById('prefectureList');
            
            if (filteredCollection.length === 0) {
                if (searchQuery) {
                    listDiv.innerHTML = '<p style="text-align:center;color:#999;">検索結果が見つかりませんでした</p>';
                } else {
                    listDiv.innerHTML = '<p style="text-align:center;color:#999;">まだ登録されていません</p>';
                }
                return;
            }
            
            // 都道府県ごとにグループ化
            const grouped = {};
            filteredCollection.forEach(sake => {
                if (!grouped[sake.prefecture]) {
                    grouped[sake.prefecture] = [];
                }
                grouped[sake.prefecture].push(sake);
            });
            
            // 都道府県を北から南の順に並べる
            const prefectureOrder = [
                '北海道', '青森県', '岩手県', '宮城県', '秋田県', '山形県', '福島県',
                '茨城県', '栃木県', '群馬県', '埼玉県', '千葉県', '東京都', '神奈川県',
                '新潟県', '富山県', '石川県', '福井県', '山梨県', '長野県', '岐阜県',
                '静岡県', '愛知県', '三重県', '滋賀県', '京都府', '大阪府', '兵庫県',
                '奈良県', '和歌山県', '鳥取県', '島根県', '岡山県', '広島県', '山口県',
                '徳島県', '香川県', '愛媛県', '高知県', '福岡県', '佐賀県', '長崎県',
                '熊本県', '大分県', '宮崎県', '鹿児島県', '沖縄県'
            ];
            const sortedPrefectures = Object.keys(grouped).sort((a, b) => {
                return prefectureOrder.indexOf(a) - prefectureOrder.indexOf(b);
            });
            
            listDiv.innerHTML = sortedPrefectures.map(pref => {
                const sakes = grouped[pref];
                const prefId = pref.replace(/[都道府県]/g, '');
                
                return `
                    <div class="prefecture-group">
                        <div class="prefecture-header" onclick="togglePrefecture('${pref}')">
                            <span class="prefecture-name">${pref}</span>
                            <span class="prefecture-count">${sakes.length}本</span>
                        </div>
                        <div class="prefecture-items" id="pref-${prefId}">
                            ${sakes.map(renderSakeItem).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateStats() {
            document.getElementById('totalCount').textContent = collection.length;
            const uniquePrefectures = new Set(collection.map(s => s.prefecture));
            document.getElementById('prefCount').textContent = uniquePrefectures.size;
        }
    </script>
</body>
</html>
